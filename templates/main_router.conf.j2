{# 主路由配置模板 #}
{% include 'base.conf.j2' %}

# ============================================================================
# 防火墙与访问控制
# ============================================================================
# INTRANET_ALLOWED (仅允许内网访问, 0: 禁用, 1: 启用)
INTRANET_ALLOWED = {{ openclash.firewall.intranet_allowed }}

# BYPASS_GATEWAY_COMPATIBLE (旁路网关兼容模式, 0: 禁用, 1: 启用)
BYPASS_GATEWAY_COMPATIBLE = 0

# COMMON_PORTS (绕过常用端口的端口列表, 0: 禁用 or "21 22 23 53 80 ...")
COMMON_PORTS = {{ openclash.firewall.common_ports }}

# ============================================================================
# 分流相关
# ============================================================================
# CHINA_IP_ROUTE (IPv4 绕过 IP 模式, 0: 禁用, 1: 绕过大陆, 2: 回国)
CHINA_IP_ROUTE = {{ openclash.routing.china_ip_route }}

# CHINA_IP6_ROUTE (IPv6 绕过 IP 模式, 0: 禁用, 1: 绕过大陆, 2: 回国)
CHINA_IP6_ROUTE = {{ openclash.routing.china_ip6_route }}

# CHNR_AUTO_UPDATE (大陆IP自动更新, 0: 禁用, 1: 启用)
CHNR_AUTO_UPDATE = {{ openclash.routing.chnr_auto_update }}

# CHNR_UPDATE_WEEK_TIME (大陆IP更新星期, 0-6 or *, 0代表星期天, *代表每天, default 0)
CHNR_UPDATE_WEEK_TIME = {{ openclash.routing.chnr_update_week_time }}

# CHNR_UPDATE_DAY_TIME (大陆IP更新小时, 0-23 or *, default 1)
CHNR_UPDATE_DAY_TIME = {{ openclash.routing.chnr_update_day_time }}

# ENABLE_META_SNIFFER (启用域名嗅探, 0: 插件不覆写, 1: 启用)
ENABLE_META_SNIFFER = {{ openclash.routing.enable_meta_sniffer }}
{% if openclash.routing.enable_meta_sniffer == 1 %}
    # ENABLE_META_SNIFFER_CUSTOM (启用自定义嗅探规则, 0: 插件不覆写, 1: 启用，使用插件内置规则)
    ENABLE_META_SNIFFER_CUSTOM = {{ openclash.routing.enable_meta_sniffer_custom }}

    # ENABLE_META_SNIFFER_PURE_IP (强制嗅探纯 IP 连接, 0: 插件不覆写, 1: 启用)
    ENABLE_META_SNIFFER_PURE_IP = {{ openclash.routing.enable_meta_sniffer_pure_ip }}
{% endif %}

# ENABLE_TCP_CONCURRENT (启用 TCP 并发, 0: 插件不覆写, 1: 启用)
ENABLE_TCP_CONCURRENT = {{ openclash.routing.enable_tcp_concurrent }}

# FIND_PROCESS_MODE (进程查找模式, 0: 插件不覆写, off: 关闭, always, strict)
FIND_PROCESS_MODE = {{ openclash.routing.find_process_mode }}

# GLOBAL_CLIENT_FINGERPRINT (全局客户端指纹, none/random/chrome/firefox/safari/ios/android/edge/360/qq/0: 插件不覆写)
GLOBAL_CLIENT_FINGERPRINT = {{ openclash.routing.global_client_fingerprint }}

# ENABLE_UNIFIED_DELAY (启用统一延迟计算, 0: 插件不覆写, 1: 启用)
ENABLE_UNIFIED_DELAY = {{ openclash.routing.enable_unified_delay }}

# ENABLE_RULE_PROXY (仅代理命中规则流量, 0: 禁用, 1: 启用)
ENABLE_RULE_PROXY = {{ openclash.routing.enable_rule_proxy }}

# ENABLE_CUSTOM_CLASH_RULES (启用用户自定义规则, 0: 禁用, 1: 启用，使用插件规则)
ENABLE_CUSTOM_CLASH_RULES = {{ openclash.routing.enable_custom_clash_rules }}

# TOLERANCE (URL-Test 策略组切换灵敏度, 毫秒数 or default 0 不覆写)
TOLERANCE = {{ openclash.routing.tolerance }}

# URLTEST_INTERVAL_MOD (测速（连通性）间隔修改, 秒数 or default 0 不覆写)
URLTEST_INTERVAL_MOD = {{ openclash.routing.urltest_interval_mod }}

# ============================================================================
# 数据库加载相关
# ============================================================================
# ENABLE_GEOIP_DAT (启用 GEOIP DAT 数据库, 0: 插件不覆写, 1: 启用)
ENABLE_GEOIP_DAT = {{ openclash.geodata.enable_geoip_dat }}

# GEODATA_LOADER (Geo 数据加载模式, memconservative/standard/0: 插件不覆写)
GEODATA_LOADER = {{ openclash.geodata.geodata_loader }}

# GeoIP MMDB 数据自动更新
GEO_AUTO_UPDATE = {{ openclash.geodata.geo_auto_update }}
GEO_UPDATE_WEEK_TIME = {{ openclash.geodata.geo_update_week_time }}
GEO_UPDATE_DAY_TIME = {{ openclash.geodata.geo_update_day_time }}

# GeoIP Dat 数据自动更新
GEOIP_AUTO_UPDATE = {{ openclash.geodata.geoip_auto_update }}
GEOIP_UPDATE_WEEK_TIME = {{ openclash.geodata.geoip_update_week_time }}
GEOIP_UPDATE_DAY_TIME = {{ openclash.geodata.geoip_update_day_time }}

# GeoSite 数据自动更新
GEOSITE_AUTO_UPDATE = {{ openclash.geodata.geosite_auto_update }}
GEOSITE_UPDATE_WEEK_TIME = {{ openclash.geodata.geosite_update_week_time }}
GEOSITE_UPDATE_DAY_TIME = {{ openclash.geodata.geosite_update_day_time }}

# GeoASN 数据自动更新
GEOASN_AUTO_UPDATE = {{ openclash.geodata.geoasn_auto_update }}
GEOASN_UPDATE_WEEK_TIME = {{ openclash.geodata.geoasn_update_week_time }}
GEOASN_UPDATE_DAY_TIME = {{ openclash.geodata.geoasn_update_day_time }}

# ============================================================================
# 其它功能
# ============================================================================
# SMALL_FLASH_MEMORY (小闪存模式, 0: 禁用, 1: 启用)
SMALL_FLASH_MEMORY = {{ openclash.misc.small_flash_memory }}

# DISABLE_QUIC_GO_GSO (禁用 QUIC GO GSO, 0: 插件不覆写, 1: 启用)
DISABLE_QUIC_GO_GSO = {{ openclash.misc.disable_quic_go_gso }}

# DELAY_START (延时启动, 0: 禁用 or 秒数)
DELAY_START = {{ openclash.misc.delay_start }}

# SKIP_PROXY_ADDRESS (跳过代理地址, 0: 禁用, 1: 启用)
SKIP_PROXY_ADDRESS = {{ openclash.misc.skip_proxy_address }}

# SUB_INFO_URL (订阅信息 URL)
SUB_INFO_URL = $EN_KEY

# DOWNLOAD_FILE (下载外部文件到指定路径, need URL and path)
{% for download in downloads %}
DOWNLOAD_FILE = url={{ download.url }}, path={{ download.path }}, cron={{ download.cron }}, force={{ download.force | lower }}
{% endfor %}

# RESTART (模块更新后重启插件, true: 启用, false: 禁用)
RESTART = {{ openclash.misc.restart | lower }}

[Overwrite]
ruby_map_edit "$CONFIG_FILE" "['proxy-providers']" "provider" "['url']" "$EN_KEY"
