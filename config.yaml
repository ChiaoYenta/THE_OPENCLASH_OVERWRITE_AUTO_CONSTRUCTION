# OpenClash Config Generator 配置文件

# ============================================================================
# 上游配置源
# ============================================================================
upstream:
  repo: "HenryChiao/mihomo_yamls"
  branch: "main"
  sync_interval: "0 2 * * *"  # Cron 表达式：每天凌晨2点同步
  
  # 同步的配置文件类别
  sync_categories:
    - "General_Config"
    - "Smart_Mode"
    - "Official_Examples"

# ============================================================================
# 输出配置
# ============================================================================
output:
  directory: "output"
  
  # 生成的配置文件类型
  formats:
    - name: "main_router"
      filename: "Overwrite-main.conf"
      description: "主路由 Url-test 模式"
      
    - name: "main_router_noipv6"
      filename: "Overwrite-main-noipv6.conf"
      description: "主路由无IPv6 Url-test"
      
    - name: "main_router_smart"
      filename: "Overwrite-main-smart.conf"
      description: "主路由 Smart 智能模式"
      
    - name: "main_router_smart_lgbm"
      filename: "Overwrite-main-smart-lgbm.conf"
      description: "主路由 Smart-LGBM 模式"
      
    - name: "bypass_router"
      filename: "Overwrite-bypass.conf"
      description: "旁路由 Url-test 模式"
      
    - name: "bypass_router_smart"
      filename: "Overwrite-bypass-smart.conf"
      description: "旁路由 Smart 模式"

# ============================================================================
# OpenClash 参数配置
# ============================================================================
openclash:
  # 基础配置
  config_file: "/etc/openclash/config/Overwrite-Clash.yaml"
  core_type: "Smart"  # Smart 或 Meta
  
  # DNS 配置
  dns:
    enable_redirect: 1           # DNS 重定向模式 (0:禁用, 1:Dnsmasq, 2:Firewall)
    enable_custom: 0             # 自定义 DNS (0:不覆写, 1:启用)
    append_default: 0            # 追加 default-nameserver DNS
    append_wan: 1                # 追加上游分配 DNS
    store_fakeip: 1              # 启用 fake-ip 缓存
    custom_fakeip_filter: 1      # 启用 Fake-IP-Filter
    fakeip_filter_mode: "blacklist"  # Fake-IP 过滤模式
    fakeip_range: "198.18.0.1/16"    # Fake-IP 地址段
    enable_respect_rules: 0      # DNS 查询遵循规则
    custom_name_policy: 0        # 自定义 Nameserver-Policy
    custom_host: 0               # 自定义 Hosts
    custom_fallback_filter: 0    # 自定义 Fallback-Filter
  
  # IPv6 配置
  ipv6:
    enable: 1                    # 启用 IPv6
    dns: 1                       # 启用 IPv6 DNS
    mode: 0                      # IPv6 代理模式 (0:TProxy, 1:Redirect, 2:TUN, 3:Mix)
    enable_v6_udp_proxy: 1       # 启用 IPv6 UDP 代理
  
  # 代理与模式
  proxy:
    mode: "fake-ip"              # 运行模式 (fake-ip/redir-host/fake-ip-tun等)
    enable_udp: 1                # 启用 UDP 代理
    disable_udp_quic: 0          # 禁用 UDP QUIC
    router_self_proxy: 1         # 路由器自身代理
    stack_type: "system"         # TUN 网络栈类型 (system/gvisor/mixed)
    proxy_mode: "rule"           # 代理模式 (rule/global/direct)
  
  # 防火墙与访问控制
  firewall:
    intranet_allowed: 0          # 仅允许内网访问
    bypass_gateway_compatible: 0 # 旁路网关兼容模式
    common_ports: 0              # 绕过常用端口
  
  # 分流相关
  routing:
    china_ip_route: 1            # IPv4 绕过 IP 模式 (0:禁用, 1:绕过大陆, 2:回国)
    china_ip6_route: 1           # IPv6 绕过 IP 模式
    chnr_auto_update: 1          # 大陆IP自动更新
    chnr_update_week_time: "*"   # 更新星期 (0-6或*)
    chnr_update_day_time: 0      # 更新小时 (0-23或*)
    enable_meta_sniffer: 1       # 启用域名嗅探
    enable_meta_sniffer_custom: 1    # 启用自定义嗅探规则
    enable_meta_sniffer_pure_ip: 1   # 强制嗅探纯 IP 连接
    enable_tcp_concurrent: 1     # 启用 TCP 并发
    find_process_mode: 0         # 进程查找模式
    global_client_fingerprint: 0 # 全局客户端指纹
    enable_unified_delay: 1      # 启用统一延迟计算
    enable_rule_proxy: 1         # 仅代理命中规则流量
    enable_custom_clash_rules: 1 # 启用用户自定义规则
    tolerance: 30                # URL-Test 策略组切换灵敏度 (毫秒)
    urltest_interval_mod: 300    # 测速间隔 (秒)
  
  # Smart 相关
  smart:
    auto_switch: 1               # 启用 Smart 自动切换
    strategy: "sticky-sessions"  # 初始数据收集策略 (sticky-sessions/round-robin)
    enable_lgbm: 0               # 启用 LightGBM 模型
    policy_priority: "Premium:0.9;SG:1.3;HK:1.5"  # 节点权重加成
    collect: 1                   # 模型训练数据收集
    collect_size: 500            # 收集文件大小 (MB)
    collect_rate: 1              # 采样率 (0-1)
    lgbm_auto_update: 0          # LGBM 模型自动更新
    lgbm_update_interval: 72     # 模型更新间隔 (小时)
  
  # 数据库加载相关
  geodata:
    enable_geoip_dat: 1          # 启用 GEOIP DAT 数据库
    geodata_loader: 0            # Geo 数据加载模式
    
    # GeoIP MMDB 数据
    geo_auto_update: 1
    geo_update_week_time: "*"
    geo_update_day_time: 1
    
    # GeoIP Dat 数据
    geoip_auto_update: 1
    geoip_update_week_time: "*"
    geoip_update_day_time: 2
    
    # GeoSite 数据
    geosite_auto_update: 1
    geosite_update_week_time: "*"
    geosite_update_day_time: 3
    
    # GeoASN 数据
    geoasn_auto_update: 1
    geoasn_update_week_time: "*"
    geoasn_update_day_time: 4
  
  # 其它功能
  misc:
    small_flash_memory: 0        # 小闪存模式
    disable_quic_go_gso: 0       # 禁用 QUIC GO GSO
    delay_start: 0               # 延时启动 (秒)
    skip_proxy_address: 1        # 跳过代理地址
    restart: true                # 模块更新后重启插件

# ============================================================================
# 下载文件配置
# ============================================================================
downloads:
  - url: "https://raw.githubusercontent.com/HenryChiao/mihomo_yamls/main/General_Config/HenryChiao_MIHOMO_AIO.yaml"
    path: "/etc/openclash/config/Overwrite-Clash.yaml"
    cron: "0 6 * * *"
    force: true
    
# ============================================================================
# GitHub Actions 配置
# ============================================================================
github_actions:
  enabled: true
  schedule: "0 2 * * *"  # 每天凌晨2点运行
  create_release: true
  release_tag_prefix: "v"
